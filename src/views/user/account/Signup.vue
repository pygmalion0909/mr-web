<template>
	<div class="signup">
		<div class="signup_contents">
			<!-- header -->
			<div class="signup_header">
				<router-link to="/" class="signup_header_link-logo">
					<img src="@/assets/icons/logo1.svg" alt="" />
				</router-link>
			</div>

			<!-- body -->
			<validObserver ref="validObserver">
				<ul class="signup_body_ul">
					<!-- id -->
					<li class="signup_body_li">
						<valid rules="required" v-slot="{ errors }">
							<p class="signup_title">ì•„ì´ë””</p>
							<input class="signup_input" type="text" v-model="loginId" placeholder="ğŸ“Œ ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." />
							<p class="signup_error">{{ errors[0] }}</p>
						</valid>
					</li>

					<!-- nick-name -->
					<li class="signup_body_li">
						<valid rules="required" v-slot="{ errors }">
							<p class="signup_title">ë‹‰ë„¤ì„</p>
							<input class="signup_input" type="text" v-model="nickName" placeholder="ğŸ“Œ ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." />
							<p class="signup_error">{{ errors[0] }}</p>
						</valid>
					</li>

					<!-- email -->
					<li class="signup_body_li">
						<valid rules="email|required" v-slot="{ errors }">
							<p class="signup_title">ì´ë©”ì¼</p>
							<input class="signup_input" type="text" v-model="email" placeholder="ğŸ“Œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." />
							<p class="signup_error">{{ errors[0] }}</p>
						</valid>
					</li>

					<!-- password -->
					<li class="signup_body_li">
						<valid rules="required|min:10|confirmed:confirmation" v-slot="{ errors }">
							<p class="signup_title">ë¹„ë°€ë²ˆí˜¸</p>
							<input
								class="signup_input signup_input--passwd"
								type="password"
								v-model="password"
								placeholder="ğŸ“Œ ë¹„ë°€ë²ˆí˜¸(10ìë¦¬ ì´ìƒ)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
							/>
							<p class="signup_error">{{ errors[0] }}</p>
						</valid>
						<valid vid="confirmation" v-slot="{ errors }">
							<input
								class="signup_input"
								type="password"
								v-model="rePassword"
								placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ í•œë²ˆë” ì…ë ¥í•´ì£¼ì„¸ìš”."
							/>
							<p class="signup_error">{{ errors[0] }}</p>
						</valid>
					</li>

					<!-- agreements -->
					<li class="signup_body_li">
						<p class="signup_title">ì„œë¹„ìŠ¤ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”</p>
						<ul class="signup_agree_ul">
							<li class="signup_agree_li signup_agree_li--all">
								<button class="signup_agree_btn signup_agree_btn--all">
									<!-- TODO signup_agree_icon--okë™ì ë°”ì¸ë”© -->
									<i class="fas fa-check-circle signup_agree_icon"></i>
									ëª¨ë‘ ë™ì˜í•©ë‹ˆë‹¤.
								</button>
							</li>
							<li class="signup_agree_li">
								<button class="signup_agree_btn">
									<i class="fas fa-check-circle signup_agree_icon"></i>
									ë§Œ 14ì„¸ ì´ìƒì…ë‹ˆë‹¤.<span class="signup_agree_must"> (í•„ìˆ˜)</span>
								</button>
							</li>
							<li class="signup_agree_li">
								<button class="signup_agree_btn">
									<i class="fas fa-check-circle signup_agree_icon"></i>
									<router-link to="/" class="signup_agree_link">ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€</router-link>ì— ë™ì˜í•©ë‹ˆë‹¤.
									<span class="signup_agree_must"> (í•„ìˆ˜)</span>
								</button>
							</li>
							<li class="signup_agree_li">
								<button class="signup_agree_btn">
									<i class="fas fa-check-circle signup_agree_icon"></i>
									<router-link to="/" class="signup_agree_link">ê°œì¸ì •ë³´ ìˆ˜ì§‘/ì´ìš©</router-link>ì— ë™ì˜í•©ë‹ˆë‹¤.
									<span class="signup_agree_must"> (í•„ìˆ˜)</span>
								</button>
							</li>
							<li class="signup_agree_li">
								<button class="signup_agree_btn">
									<i class="fas fa-check-circle signup_agree_icon"></i>
									ì´ë²¤íŠ¸ í• ì¸ í˜œíƒ ì•Œë¦¼ ìˆ˜ì‹ ì— ë™ì˜í•©ë‹ˆë‹¤.<span> (ì„ íƒ)</span>
								</button>
							</li>
							<li class="signup_agree_li">
								<button class="signup_agree_btn">
									<i class="fas fa-check-circle signup_agree_icon"></i>
									ì¥ê¸° ë¯¸ì ‘ì† ì‹œ ê³„ì • í™œì„± ìƒíƒœ ìœ ì§€í•©ë‹ˆë‹¤.<span> (ì„ íƒ)</span>
								</button>
							</li>
						</ul>
					</li>

					<!-- btn -->
					<!-- TODO signup_btn-signup--okë™ì ë°”ì¸ë”© -->
					<li class="signup_body_li">
						<button class="signup_btn-signup" @click="signup">ê°€ì…ì™„ë£Œ</button>
					</li>
				</ul>
			</validObserver>
			<p class="signup_footer">Â© 2021 By Superpil-ê¹€ê²½í•„. ALL RIGHTS RESERVED.</p>
		</div>
	</div>
</template>

<script>
import { apiSignup } from "@/api/user/user";

export default {
	data() {
		return {
			loginId: "",
			nickName: "",
			password: "",
			email: "",
			rePassword: "",
		};
	},
	methods: {
		async signup() {
			try {
				if (!confirm("í˜„ì¬ ì •ì‹ì˜¤í”ˆì„ ì‹œì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ê°€ì…í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
				// check valid
				if (!(await this.$refs.validObserver.validate())) return alert("ê°€ì… í•„ìˆ˜í•­ëª©(ğŸ“Œ)ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.ğŸ™");
				const payload = {
					loginId: this.loginId,
					nickName: this.nickName,
					email: this.email,
					password: this.password,
				};
				await apiSignup(payload);
				alert("ì¸ì¦ë²ˆí˜¸ê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
				// ì´ë©”ì¼ ì¸ì¦í˜ì´ì§€ ì´ë™
				this.$router.push({ name: "signupAppro", query: { loginId: this.loginId } });
				// ì´ˆê¸°í™”
				this.init();
			} catch (e) {
				if (e.response.data.code === "1") {
					if (e.response.data.error.msg === "duplication") {
						if (e.response.data.error.param === "loginId") return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¡œê·¸ì¸ID ì…ë‹ˆë‹¤.");
						if (e.response.data.error.param === "nickName") return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë‹‰ë„¤ì„ ì…ë‹ˆë‹¤.");
						if (e.response.data.error.param === "email") return alert("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ ì…ë‹ˆë‹¤.");
					}
				} else {
					if (!confirm("ğŸš‘ì˜ˆìƒì¹˜ ëª»í•œ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê³ ê°ì„¼í„°ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
				}
			}
		},
		init() {
			this.loginId = "";
			this.nickName = "";
			this.password = "";
			this.email = "";
			this.rePassword = "";
		},
		cancel() {
			if (!confirm("ì‘ì„±í•˜ì‹  ì •ë³´ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤. ê·¸ë˜ë„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
			this.$router.push({ name: "home" });
		},
	},
};
</script>
